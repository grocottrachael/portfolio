<div class="protected">

    <div class="protected__alert" data-id="alert" style="display:none">You entered the wrong password</div>

    <div class="protected__content">
        <h1 class="protected__content__heading">You need a password to continue</h1>
        <input class="protected__content__input" data-id="password" type="password" placeholder="password"/>
        <button data-id="button" type="button" class="protected__content__btn">Continue</button>
    </div>

</div>

<script type="text/javascript" src="https://cdn.rawgit.com/chrisveness/crypto/master/sha1.js"></script>
<script type="text/javascript">

    "use strict";

    var pathArray = window.location.pathname.split( '/' );
    var projectPath = pathArray[pathArray.length - 1];

    var button = document.querySelectorAll('[data-id="button"]');
    var password = document.querySelectorAll('[data-id="password"]');

    function login(secret) {
        var hash = Sha1.hash(secret);
        var url = "/" + hash + "/"+ projectPath;
        var alert = document.querySelectorAll('[data-id="alert"]');
        var request = new XMLHttpRequest();

        request.open('GET', url, true);

        function handleError() {
            alert[0].style.display = 'block';
            password[0].setAttribute('placeholder', 'Incorrect password');
            password[0].value = '';
        }

        request.onload = function () {
            if (request.status >= 200 && request.status < 400) {
                window.location = url
            } else {
                handleError();
            }
        };
        request.onerror = handleError;
        request.send();
    }

    button[0].addEventListener("click", function () {
        login(password[0].value)
    });

    document.onkeydown = function (e) {
        e = e || window.event;
        if (e.keyCode === 13) {
            login(password[0].value)
        }
    }

</script>
